# Choosy 后端配置文件
# 复制此文件为 config.toml 并填入实际值

[app]
name = "Choosy API"
version = "1.0.0"
debug = true

[log]
level = "debug"  # debug, info, warn, error
format = "console"  # console, json

[server]
host = "0.0.0.0"
port = 18000

[database]
url = "db/choosy.db"

[cors]
origins = ["*"]
allow_credentials = true
allow_methods = ["*"]
allow_headers = ["*"]

# 阿里通义千问 API 配置 (https://dashscope.console.aliyun.com/)
[dashscope]
api-key = ""

# OpenRouter API 配置 (https://openrouter.ai/keys)
[openrouter]
api-key = ""  # OpenRouter API Key，可使用免费模型
model = "xiaomi/mimo-v2-flash:free"  # MiMo-V2-Flash 免费模型，支持工具调用，推荐用于 agent 场景

# 高德地图 API 配置 (https://console.amap.com/)
# 用于：1. 逆地理编码（经纬度转地址）2. 天气查询
[amap]
api-key = ""  # 高德地图 Web 服务 API Key

# 微信小程序配置 (https://mp.weixin.qq.com/)
[idps.wxmp]
appid = ""  # 微信小程序 AppID
secret = ""  # 微信小程序 Secret

# 认证配置
[auth]
issuer = "choosy.heliannuuthus.com"
audience = "choosy"
expires-in = 7200           # access_token 过期时间(秒)，2小时
refresh-expires-in = 365     # refresh_token 过期时间(天)，1年
max-refresh-token = 10       # 每用户最大 refresh_token 数

# KMS 密钥配置（使用 python3 scripts/genkeys.py 生成）
[kms.token]
sign-key = ""  # Ed25519 签名密钥（base64url 编码的 JWK JSON）
enc-key = ""   # A256GCM 加密密钥（base64url 编码的 JWK JSON）

[kms.database]
enc-key = ""   # AES-256-GCM 加密密钥（Base64 编码，32字节）

# 首页轮播图配置
[[home.banners]]
id = "banner_1"
image-url = "https://example.com/banner1.jpg"
title = "今日推荐"
link = ""
link-type = "none"  # recipe, url, none

[[home.banners]]
id = "banner_2"
image-url = "https://example.com/banner2.jpg"
title = "新菜上线"
link = "recipe_id_here"
link-type = "recipe"

# 阿里云 OSS 配置（用于图片上传）
[oss]
endpoint = ""           # OSS 地域节点，如 oss-cn-hangzhou.aliyuncs.com
access-key-id = ""      # AccessKey ID
access-key-secret = ""  # AccessKey Secret
bucket = ""             # Bucket 名称
domain = ""             # 自定义域名（可选），如 https://cdn.example.com，不配置则使用 OSS 默认域名
region = ""             # STS 区域（可选，默认从 endpoint 提取）

role-arn = ""           # RAM 角色 ARN，如 acs:ram::123456789012:role/oss-upload-role（STS 临时凭证配置，用于安全上传，1小时有效期）
