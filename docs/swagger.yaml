basePath: /api
definitions:
  auth.CaptureConfig:
    properties:
      required:
        description: 是否需要人机验证
        type: boolean
      site_key:
        description: 站点密钥（前端使用）
        type: string
      type:
        description: 验证类型：captcha/turnstile/hcaptcha
        type: string
    type: object
  auth.Error:
    properties:
      error:
        type: string
      error_description:
        type: string
    type: object
  auth.IDPConfig:
    properties:
      allowed_scopes:
        description: 该 connection 允许的 scopes
        items:
          type: string
        type: array
      capture:
        allOf:
        - $ref: '#/definitions/auth.CaptureConfig'
        description: 人机验证配置
      client_id:
        description: IDP 的客户端 ID
        type: string
      extra:
        additionalProperties: true
        description: 其他配置信息
        type: object
      type:
        description: Connection（IDP）类型
        type: string
    type: object
  auth.IDPsResponse:
    properties:
      idps:
        items:
          $ref: '#/definitions/auth.IDPConfig'
        type: array
    type: object
  auth.IntrospectResponse:
    properties:
      active:
        type: boolean
      aud:
        type: string
      email:
        type: string
      exp:
        type: integer
      iat:
        type: integer
      iss:
        type: string
      nickname:
        type: string
      phone:
        type: string
      picture:
        type: string
      scope:
        type: string
      sub:
        type: string
    type: object
  auth.LoginRequest:
    properties:
      connection:
        description: 身份提供方（IDP）
        type: string
      data:
        additionalProperties:
          type: string
        description: Connection 需要的数据
        type: object
    required:
    - connection
    - data
    type: object
  auth.LoginResponse:
    properties:
      code:
        description: 授权码
        type: string
      redirect_uri:
        description: 重定向 URI
        type: string
    type: object
  auth.TokenResponse:
    properties:
      access_token:
        type: string
      expires_in:
        type: integer
      refresh_token:
        description: 只有 offline_access 时返回
        type: string
      scope:
        description: 实际授予的 scope
        type: string
      token_type:
        type: string
    type: object
  auth.UpdateUserInfoRequest:
    properties:
      nickname:
        maxLength: 64
        type: string
      picture:
        maxLength: 512
        type: string
    type: object
  auth.UserInfoResponse:
    properties:
      email:
        description: 脱敏
        type: string
      nickname:
        type: string
      phone:
        description: 脱敏
        type: string
      picture:
        type: string
      sub:
        type: string
    type: object
  favorite.BatchCheckRequest:
    properties:
      recipe_ids:
        items:
          type: string
        type: array
    required:
    - recipe_ids
    type: object
  favorite.BatchCheckResponse:
    properties:
      favorited_ids:
        items:
          type: string
        type: array
    type: object
  favorite.CheckFavoriteResponse:
    properties:
      is_favorite:
        type: boolean
    type: object
  favorite.FavoriteListItem:
    properties:
      created_at:
        type: string
      recipe:
        $ref: '#/definitions/favorite.RecipeListItem'
      recipe_id:
        type: string
    type: object
  favorite.FavoriteListResponse:
    properties:
      items:
        items:
          $ref: '#/definitions/favorite.FavoriteListItem'
        type: array
      total:
        type: integer
    type: object
  favorite.FavoriteRequest:
    properties:
      recipe_id:
        type: string
    required:
    - recipe_id
    type: object
  favorite.FavoriteResponse:
    properties:
      created_at:
        type: string
      recipe_id:
        type: string
    type: object
  favorite.RecipeListItem:
    properties:
      category:
        type: string
      description:
        type: string
      difficulty:
        type: integer
      id:
        type: string
      image_path:
        type: string
      name:
        type: string
      tags:
        $ref: '#/definitions/favorite.TagsGrouped'
      total_time_minutes:
        type: integer
    type: object
  favorite.TagsGrouped:
    properties:
      cuisines:
        items:
          type: string
        type: array
      flavors:
        items:
          type: string
        type: array
      scenes:
        items:
          type: string
        type: array
    type: object
  history.HistoryListItem:
    properties:
      recipe:
        $ref: '#/definitions/history.RecipeListItem'
      recipe_id:
        type: string
      viewed_at:
        type: string
    type: object
  history.HistoryListResponse:
    properties:
      items:
        items:
          $ref: '#/definitions/history.HistoryListItem'
        type: array
      total:
        type: integer
    type: object
  history.HistoryRequest:
    properties:
      recipe_id:
        type: string
    required:
    - recipe_id
    type: object
  history.HistoryResponse:
    properties:
      recipe_id:
        type: string
      viewed_at:
        type: string
    type: object
  history.RecipeListItem:
    properties:
      category:
        type: string
      description:
        type: string
      difficulty:
        type: integer
      id:
        type: string
      image_path:
        type: string
      name:
        type: string
      tags:
        $ref: '#/definitions/history.TagsGrouped'
      total_time_minutes:
        type: integer
    type: object
  history.TagsGrouped:
    properties:
      cuisines:
        items:
          type: string
        type: array
      flavors:
        items:
          type: string
        type: array
      scenes:
        items:
          type: string
        type: array
    type: object
  home.BannerItem:
    properties:
      id:
        type: string
      image_url:
        type: string
      link:
        type: string
      link_type:
        type: string
      title:
        type: string
    type: object
  home.RecipeListItem:
    properties:
      category:
        type: string
      description:
        type: string
      difficulty:
        type: integer
      id:
        type: string
      image_path:
        type: string
      name:
        type: string
      tags:
        $ref: '#/definitions/home.TagsGrouped'
      total_time_minutes:
        type: integer
    type: object
  home.TagsGrouped:
    properties:
      cuisines:
        items:
          type: string
        type: array
      flavors:
        items:
          type: string
        type: array
      scenes:
        items:
          type: string
        type: array
    type: object
  preference.OptionItem:
    properties:
      label:
        description: 显示名称
        type: string
      value:
        description: 标签值
        type: string
    type: object
  preference.OptionItemWithSelected:
    properties:
      label:
        description: 显示名称
        type: string
      selected:
        description: 是否已选择
        type: boolean
      value:
        description: 标签值
        type: string
    type: object
  preference.OptionsResponse:
    properties:
      allergies:
        description: 过敏选项
        items:
          $ref: '#/definitions/preference.OptionItem'
        type: array
      flavors:
        description: 口味选项
        items:
          $ref: '#/definitions/preference.OptionItem'
        type: array
      taboos:
        description: 忌口选项
        items:
          $ref: '#/definitions/preference.OptionItem'
        type: array
    type: object
  preference.UpdatePreferencesRequest:
    properties:
      allergies:
        description: 过敏选项值列表
        items:
          type: string
        type: array
      flavors:
        description: 口味选项值列表
        items:
          type: string
        type: array
      taboos:
        description: 忌口选项值列表
        items:
          type: string
        type: array
    type: object
  preference.UserPreferencesResponse:
    properties:
      allergies:
        description: 过敏偏好
        items:
          $ref: '#/definitions/preference.OptionItemWithSelected'
        type: array
      flavors:
        description: 口味偏好
        items:
          $ref: '#/definitions/preference.OptionItemWithSelected'
        type: array
      taboos:
        description: 忌口偏好
        items:
          $ref: '#/definitions/preference.OptionItemWithSelected'
        type: array
    type: object
  recipe.CategoryResponse:
    properties:
      key:
        type: string
      label:
        type: string
    type: object
  recipe.IngredientRequest:
    properties:
      name:
        type: string
      notes:
        type: string
      quantity:
        type: number
      text_quantity:
        type: string
      unit:
        type: string
    required:
    - name
    - text_quantity
    type: object
  recipe.IngredientResponse:
    properties:
      category:
        type: string
      id:
        type: integer
      name:
        type: string
      notes:
        type: string
      quantity:
        type: number
      text_quantity:
        type: string
      unit:
        type: string
    type: object
  recipe.RecipeCreateRequest:
    properties:
      additional_notes:
        items:
          type: string
        type: array
      category:
        type: string
      cook_time_minutes:
        type: integer
      description:
        type: string
      difficulty:
        type: integer
      id:
        type: string
      images:
        items:
          type: string
        type: array
      ingredients:
        items:
          $ref: '#/definitions/recipe.IngredientRequest'
        type: array
      name:
        type: string
      prep_time_minutes:
        type: integer
      servings:
        type: integer
      steps:
        items:
          $ref: '#/definitions/recipe.StepRequest'
        type: array
      tags:
        items:
          type: string
        type: array
      total_time_minutes:
        type: integer
    required:
    - category
    - difficulty
    - name
    - servings
    type: object
  recipe.RecipeListItem:
    properties:
      category:
        type: string
      description:
        type: string
      difficulty:
        type: integer
      id:
        type: string
      image_path:
        type: string
      name:
        type: string
      tags:
        $ref: '#/definitions/recipe.TagsGrouped'
      total_time_minutes:
        type: integer
    type: object
  recipe.RecipeResponse:
    properties:
      additional_notes:
        items:
          type: string
        type: array
      category:
        type: string
      cook_time_minutes:
        type: integer
      description:
        type: string
      difficulty:
        type: integer
      id:
        type: string
      image_path:
        type: string
      images:
        items:
          type: string
        type: array
      ingredients:
        items:
          $ref: '#/definitions/recipe.IngredientResponse'
        type: array
      name:
        type: string
      prep_time_minutes:
        type: integer
      servings:
        type: integer
      steps:
        items:
          $ref: '#/definitions/recipe.StepResponse'
        type: array
      tags:
        $ref: '#/definitions/recipe.TagsGrouped'
      total_time_minutes:
        type: integer
    type: object
  recipe.RecipeUpdateRequest:
    properties:
      additional_notes:
        items:
          type: string
        type: array
      category:
        type: string
      cook_time_minutes:
        type: integer
      description:
        type: string
      difficulty:
        type: integer
      images:
        items:
          type: string
        type: array
      ingredients:
        items:
          $ref: '#/definitions/recipe.IngredientRequest'
        type: array
      name:
        type: string
      prep_time_minutes:
        type: integer
      servings:
        type: integer
      steps:
        items:
          $ref: '#/definitions/recipe.StepRequest'
        type: array
      tags:
        items:
          type: string
        type: array
      total_time_minutes:
        type: integer
    type: object
  recipe.StepRequest:
    properties:
      description:
        type: string
      step:
        type: integer
    required:
    - description
    - step
    type: object
  recipe.StepResponse:
    properties:
      description:
        type: string
      id:
        type: integer
      step:
        type: integer
    type: object
  recipe.TagsGrouped:
    properties:
      cuisines:
        items:
          type: string
        type: array
      flavors:
        items:
          type: string
        type: array
      scenes:
        items:
          type: string
        type: array
    type: object
  recommend.ContextRequest:
    properties:
      latitude:
        type: number
      longitude:
        type: number
      timestamp:
        type: integer
    type: object
  recommend.ContextResponse:
    properties:
      location:
        $ref: '#/definitions/recommend.LocationInfo'
      time:
        $ref: '#/definitions/recommend.TimeInfo'
      weather:
        $ref: '#/definitions/recommend.WeatherInfoResponse'
    type: object
  recommend.LocationInfo:
    properties:
      city:
        type: string
      district:
        type: string
      province:
        type: string
    type: object
  recommend.RecommendRecipeItem:
    properties:
      category:
        type: string
      description:
        type: string
      difficulty:
        type: integer
      id:
        type: string
      image_path:
        type: string
      name:
        type: string
      reason:
        description: 该菜品的推荐理由
        type: string
      tags:
        $ref: '#/definitions/recommend.TagsGrouped'
      total_time_minutes:
        type: integer
    type: object
  recommend.RecommendRequest:
    properties:
      exclude_ids:
        description: 排除的菜谱 ID（换一批时传入已推荐的）
        items:
          type: string
        type: array
      latitude:
        type: number
      longitude:
        type: number
      timestamp:
        type: integer
    required:
    - latitude
    - longitude
    type: object
  recommend.RecommendResponse:
    properties:
      recipes:
        items:
          $ref: '#/definitions/recommend.RecommendRecipeItem'
        type: array
      remaining:
        description: 今日剩余推荐次数
        type: integer
      summary:
        description: LLM 生成的一句话整体评价
        type: string
    type: object
  recommend.TagsGrouped:
    properties:
      cuisines:
        items:
          type: string
        type: array
      flavors:
        items:
          type: string
        type: array
      scenes:
        items:
          type: string
        type: array
    type: object
  recommend.TimeInfo:
    properties:
      day_of_week:
        type: integer
      hour:
        type: integer
      meal_time:
        type: string
      season:
        type: string
      timestamp:
        type: integer
    type: object
  recommend.WeatherInfoResponse:
    properties:
      humidity:
        type: integer
      icon:
        type: string
      temperature:
        type: number
      weather:
        type: string
    type: object
  tag.CreateTagRequest:
    properties:
      label:
        description: 显示名称
        type: string
      recipe_id:
        description: 菜谱ID（可选，为空时创建选项）
        type: string
      type:
        description: 标签类型
        type: string
      value:
        description: 标签值
        type: string
    required:
    - label
    - type
    - value
    type: object
  tag.TagValueResponse:
    properties:
      label:
        type: string
      value:
        type: string
    type: object
  tag.UpdateTagRequest:
    properties:
      label:
        type: string
    required:
    - label
    type: object
  upload.UploadImageResponse:
    properties:
      url:
        description: 上传后的图片 URL
        type: string
    type: object
host: localhost:18000
info:
  contact: {}
  description: Helios 统一后端 API - 提供认证、业务和身份与访问管理服务
  title: Helios API
  version: "1.0"
paths:
  /api/home/banners:
    get:
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/home.BannerItem'
            type: array
      summary: 获取首页 Banner
      tags:
      - home
  /api/home/hot:
    get:
      parameters:
      - default: 6
        description: 数量限制
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/home.RecipeListItem'
            type: array
      summary: 获取热门菜谱（按收藏数排序）
      tags:
      - home
  /api/home/recommend:
    get:
      parameters:
      - default: 4
        description: 数量限制
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/home.RecipeListItem'
            type: array
      summary: 获取推荐菜谱（随机）
      tags:
      - home
  /api/preferences:
    get:
      description: 获取口味、忌口、过敏的所有可选选项（从缓存索引获取，性能最优）
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/preference.OptionsResponse'
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 获取所有偏好选项
      tags:
      - preference
  /api/recipes:
    get:
      parameters:
      - description: 分类
        in: query
        name: category
        type: string
      - description: 搜索关键词
        in: query
        name: search
        type: string
      - default: 100
        description: 限制数量
        in: query
        name: limit
        type: integer
      - default: 0
        description: 偏移量
        in: query
        name: offset
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/recipe.RecipeListItem'
            type: array
      summary: 获取菜谱列表
      tags:
      - recipes
    post:
      consumes:
      - application/json
      parameters:
      - description: 菜谱信息
        in: body
        name: recipe
        required: true
        schema:
          $ref: '#/definitions/recipe.RecipeCreateRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/recipe.RecipeResponse'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 创建新菜谱
      tags:
      - recipes
  /api/recipes/{recipe_id}:
    delete:
      parameters:
      - description: 菜谱ID
        in: path
        name: recipe_id
        required: true
        type: string
      responses:
        "204":
          description: No Content
        "404":
          description: Not Found
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 删除菜谱
      tags:
      - recipes
    get:
      parameters:
      - description: 菜谱ID
        in: path
        name: recipe_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/recipe.RecipeResponse'
        "404":
          description: Not Found
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 获取菜谱详情
      tags:
      - recipes
    put:
      consumes:
      - application/json
      parameters:
      - description: 菜谱ID
        in: path
        name: recipe_id
        required: true
        type: string
      - description: 更新内容
        in: body
        name: recipe
        required: true
        schema:
          $ref: '#/definitions/recipe.RecipeUpdateRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/recipe.RecipeResponse'
        "404":
          description: Not Found
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 更新菜谱
      tags:
      - recipes
  /api/recipes/batch:
    post:
      consumes:
      - application/json
      parameters:
      - description: 菜谱列表
        in: body
        name: recipes
        required: true
        schema:
          items:
            $ref: '#/definitions/recipe.RecipeCreateRequest'
          type: array
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            items:
              $ref: '#/definitions/recipe.RecipeResponse'
            type: array
      summary: 批量创建菜谱
      tags:
      - recipes
  /api/recipes/categories/list:
    get:
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/recipe.CategoryResponse'
            type: array
      summary: 获取所有分类
      tags:
      - recipes
  /api/recommend:
    post:
      consumes:
      - application/json
      description: 根据地理位置、天气、时间等因素智能推荐菜谱（基于 LLM，支持用户个性化）
      parameters:
      - description: 推荐请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/recommend.RecommendRequest'
      - default: 6
        description: 返回数量
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/recommend.RecommendResponse'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 获取智能推荐菜谱
      tags:
      - recommend
  /api/recommend/context:
    post:
      consumes:
      - application/json
      description: 根据经纬度获取位置、天气、时间信息
      parameters:
      - description: 上下文请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/recommend.ContextRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/recommend.ContextResponse'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: 获取推荐上下文
      tags:
      - recommend
  /api/tags:
    get:
      description: 获取标签列表，支持通过查询参数过滤。所有类型（cuisine/flavor/scene/taboo/allergy）都统一使用此接口
      parameters:
      - description: '标签类型: cuisine/flavor/scene/taboo/allergy'
        in: query
        name: type
        type: string
      - description: 菜谱ID（获取特定菜谱的标签，仅用于 cuisine/flavor/scene）
        in: query
        name: recipe_id
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/tag.TagValueResponse'
            type: array
      summary: 获取标签列表
      tags:
      - tags
    post:
      consumes:
      - application/json
      description: 创建标签或选项。如果 recipe_id 为空，创建选项（仅支持 taboo/allergy）；如果 recipe_id 不为空，创建菜谱标签
      parameters:
      - description: 标签信息
        in: body
        name: tag
        required: true
        schema:
          $ref: '#/definitions/tag.CreateTagRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/tag.TagValueResponse'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 创建标签
      tags:
      - tags
  /api/tags/{type}:
    get:
      description: 支持所有类型：cuisine/flavor/scene/taboo/allergy
      parameters:
      - description: '标签类型: cuisine/flavor/scene/taboo/allergy'
        in: path
        name: type
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/tag.TagValueResponse'
            type: array
      summary: 根据类型获取标签
      tags:
      - tags
  /api/tags/{type}/{value}:
    delete:
      description: 删除标签或选项
      parameters:
      - description: 标签类型
        in: path
        name: type
        required: true
        type: string
      - description: 标签值
        in: path
        name: value
        required: true
        type: string
      - description: 菜谱ID（删除菜谱标签时必填，删除选项时留空）
        in: query
        name: recipe_id
        type: string
      responses:
        "204":
          description: No Content
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 删除标签
      tags:
      - tags
    put:
      consumes:
      - application/json
      description: 更新标签或选项的显示名称
      parameters:
      - description: 标签类型
        in: path
        name: type
        required: true
        type: string
      - description: 标签值
        in: path
        name: value
        required: true
        type: string
      - description: 菜谱ID（更新菜谱标签时必填，更新选项时留空）
        in: query
        name: recipe_id
        type: string
      - description: 更新内容
        in: body
        name: tag
        required: true
        schema:
          $ref: '#/definitions/tag.UpdateTagRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/tag.TagValueResponse'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 更新标签
      tags:
      - tags
  /api/tags/cuisines:
    get:
      deprecated: true
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/tag.TagValueResponse'
            type: array
      summary: 获取所有菜系
      tags:
      - tags
  /api/tags/flavors:
    get:
      deprecated: true
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/tag.TagValueResponse'
            type: array
      summary: 获取所有口味
      tags:
      - tags
  /api/tags/scenes:
    get:
      deprecated: true
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/tag.TagValueResponse'
            type: array
      summary: 获取所有场景
      tags:
      - tags
  /api/upload/image:
    post:
      consumes:
      - multipart/form-data
      parameters:
      - description: 完整的 OSS 对象键，如 avatars/user123.jpg（优先级高于 prefix）
        in: formData
        name: object-key
        type: string
      - description: 文件路径前缀，如 avatars, images（当 object-key 为空时使用）
        in: formData
        name: prefix
        type: string
      - description: 图片文件
        in: formData
        name: file
        required: true
        type: file
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/upload.UploadImageResponse'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - Bearer: []
      summary: 上传图片到 OSS
      tags:
      - upload
  /api/user/favorites:
    get:
      parameters:
      - description: 分类筛选
        in: query
        name: category
        type: string
      - description: 搜索关键词
        in: query
        name: search
        type: string
      - default: 20
        description: 限制数量
        in: query
        name: limit
        type: integer
      - default: 0
        description: 偏移量
        in: query
        name: offset
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/favorite.FavoriteListResponse'
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 获取收藏列表
      tags:
      - favorites
    post:
      consumes:
      - application/json
      parameters:
      - description: 收藏信息
        in: body
        name: favorite
        required: true
        schema:
          $ref: '#/definitions/favorite.FavoriteRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/favorite.FavoriteResponse'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 添加收藏
      tags:
      - favorites
  /api/user/favorites/{recipe_id}:
    delete:
      parameters:
      - description: 菜谱ID
        in: path
        name: recipe_id
        required: true
        type: string
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 取消收藏
      tags:
      - favorites
  /api/user/favorites/{recipe_id}/check:
    get:
      parameters:
      - description: 菜谱ID
        in: path
        name: recipe_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/favorite.CheckFavoriteResponse'
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 检查是否已收藏
      tags:
      - favorites
  /api/user/favorites/batch-check:
    post:
      consumes:
      - application/json
      parameters:
      - description: 菜谱ID列表
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/favorite.BatchCheckRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/favorite.BatchCheckResponse'
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 批量检查收藏状态
      tags:
      - favorites
  /api/user/history:
    delete:
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 清空浏览历史
      tags:
      - history
    get:
      parameters:
      - description: 分类筛选
        in: query
        name: category
        type: string
      - description: 搜索关键词
        in: query
        name: search
        type: string
      - default: 20
        description: 限制数量
        in: query
        name: limit
        type: integer
      - default: 0
        description: 偏移量
        in: query
        name: offset
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/history.HistoryListResponse'
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 获取浏览历史列表
      tags:
      - history
    post:
      consumes:
      - application/json
      parameters:
      - description: 浏览记录信息
        in: body
        name: history
        required: true
        schema:
          $ref: '#/definitions/history.HistoryRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/history.HistoryResponse'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 添加浏览记录
      tags:
      - history
  /api/user/history/{recipe_id}:
    delete:
      parameters:
      - description: 菜谱ID
        in: path
        name: recipe_id
        required: true
        type: string
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 删除浏览记录
      tags:
      - history
  /api/user/preference:
    get:
      description: 获取当前用户的偏好设置（包含选中状态）
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/preference.UserPreferencesResponse'
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: 获取用户偏好
      tags:
      - preference
    put:
      consumes:
      - application/json
      description: 更新当前用户的偏好设置（全量替换）
      parameters:
      - description: 偏好设置
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/preference.UpdatePreferencesRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: 更新用户偏好
      tags:
      - preference
  /auth/authorize:
    get:
      description: OAuth2.1/OIDC 授权端点，创建认证会话，设置 auth-session Cookie，然后重定向到登录页面
      parameters:
      - description: 响应类型，必须为 code
        enum:
        - code
        in: query
        name: response_type
        required: true
        type: string
      - description: 客户端 ID
        in: query
        name: client_id
        required: true
        type: string
      - description: 重定向 URI
        in: query
        name: redirect_uri
        required: true
        type: string
      - description: PKCE Code Challenge
        in: query
        name: code_challenge
        required: true
        type: string
      - description: PKCE 方法，必须为 S256
        enum:
        - S256
        in: query
        name: code_challenge_method
        required: true
        type: string
      - description: 状态参数
        in: query
        name: state
        type: string
      - description: 授权范围
        in: query
        name: scope
        type: string
      responses:
        "302":
          description: 重定向到登录页面
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/auth.Error'
      summary: 创建认证会话并重定向到登录页面
      tags:
      - auth
  /auth/introspect:
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: 验证 Token 并返回完整元数据（需要 Service JWT 认证）
      parameters:
      - description: Access Token
        in: formData
        name: token
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/auth.IntrospectResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/auth.Error'
      security:
      - Bearer: []
      summary: Token 内省
      tags:
      - auth
  /auth/login:
    post:
      consumes:
      - application/json
      description: 使用 connection（IDP）和对应的 data 完成登录，返回授权码。
      parameters:
      - description: 登录请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/auth.LoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/auth.LoginResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/auth.Error'
        "412":
          description: Session 过期
          schema:
            $ref: '#/definitions/auth.Error'
      summary: 认证登录
      tags:
      - auth
  /auth/logout:
    post:
      description: 撤销用户所有 Token
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/auth.Error'
      security:
      - Bearer: []
      summary: 登出
      tags:
      - auth
  /auth/revoke:
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: 撤销 Refresh Token
      parameters:
      - description: Token
        in: formData
        name: token
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
      summary: 撤销 Token
      tags:
      - auth
  /auth/token:
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: OAuth2 Token 端点
      parameters:
      - description: 授权类型
        enum:
        - authorization_code
        - refresh_token
        in: formData
        name: grant_type
        required: true
        type: string
      - description: 授权码
        in: formData
        name: code
        type: string
      - description: 重定向 URI
        in: formData
        name: redirect_uri
        type: string
      - description: 客户端 ID
        in: formData
        name: client_id
        required: true
        type: string
      - description: PKCE 验证器
        in: formData
        name: code_verifier
        type: string
      - description: Refresh Token
        in: formData
        name: refresh_token
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/auth.TokenResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/auth.Error'
      summary: 获取 Token
      tags:
      - auth
  /auth/userinfo:
    get:
      description: 根据 Token 的 scope 返回用户信息（敏感信息脱敏）
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/auth.UserInfoResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/auth.Error'
      security:
      - Bearer: []
      summary: 获取用户信息
      tags:
      - auth
    put:
      consumes:
      - application/json
      description: 更新当前用户信息
      parameters:
      - description: 更新请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/auth.UpdateUserInfoRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/auth.UserInfoResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/auth.Error'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/auth.Error'
      security:
      - Bearer: []
      summary: 更新用户信息
      tags:
      - auth
  /idps:
    get:
      description: 根据 client_id 获取可用的认证源（Connection）配置，包括 Capture 配置
      parameters:
      - description: 客户端 ID
        in: query
        name: client_id
        required: true
        type: string
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/auth.IDPsResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/auth.Error'
      summary: 获取认证源配置
      tags:
      - auth
securityDefinitions:
  Bearer:
    description: 输入 "Bearer {token}"
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
